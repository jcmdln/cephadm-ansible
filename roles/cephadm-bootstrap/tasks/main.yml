# tasks file for cephadm-bootstrap

- include: host.yml
- include: cephadm.yml
- include: ssh.yml

- name: Create /etc/ceph directory
  file:
    path: /etc/ceph
    state: directory

- name: Generate ceph.conf, deploy mgr/mons daemons
  command: >-
    cephadm bootstrap
    --allow-fqdn-hostname
    --skip-dashboard
    --skip-firewalld
    --skip-mon-network
    --skip-monitoring-stack
    --skip-ssh
    --mon-ip {{ ansible_facts[cephadm_network_interface_public][cephadm_network_ip_version].address }}

- name: Enable 'cephadm' orchestrator module
  command: >-
    cephadm shell -- ceph orch module enable cephadm

- name: Use 'cephadm' as orchestrator backend
  command: >-
    cephadm shell -- ceph orch set backend cephadm

- name: Add other hosts to cluster
  command: >-
    cephadm shell -- ceph orch host add {{ item }}
  when: (cephadm_hosts | length) > 0
  with_items: "{{ cephadm_hosts | difference(inventory_hostname) }}"
