---
- name: Enable dashboard
  command: >-
    cephadm shell -- ceph mgr module enable dashboard
  changed_when:
    - result.rc is defined
    - result.rc > 0
  register: result

- name: Create self-signed certificate
  command: >-
    cephadm shell -- ceph dashboard create-self-signed-cert
  changed_when:
    - result.rc is defined
    - result.rc > 0
  register: result

- name: Set dashboard address
  command: >-
    cephadm shell -- ceph config set mgr mgr/dashboard/server_addr
    {{ cephadm_dashboard_server_addr }}
  changed_when:
    - result.rc is defined
    - result.rc > 0
  register: result

- name: Set dashboard port
  command: >-
    cephadm shell -- ceph config set mgr mgr/dashboard/server_port
    {{ cephadm_dashboard_server_port }}
  changed_when:
    - result.rc is defined
    - result.rc > 0
  register: result

- name: Set dashboard secure port
  command: >-
    cephadm shell -- ceph config set mgr mgr/dashboard/ssl_server_port
    {{ cephadm_dashboard_ssl_server_port }}
  changed_when:
    - result.rc is defined
    - result.rc > 0
  register: result

- name: Create dashboard account
  command: >-
    cephadm shell -- ceph dashboard ac-user-create
    {{ cephadm_dashboard_username }}
    {{ cephadm_dashboard_password }}
    administrator
  changed_when:
    - result.rc is defined
    - result.rc > 0
  register: result
