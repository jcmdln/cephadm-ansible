---
# cephadm-check/tasks/main.yml

- name: Check if Python 3 is present
  raw: |-
    command -v python3
  changed_when: false

- name: Gather facts
  setup:
    gather_subset: all

- name: check if host OS is supported
  fail:
    msg: >-
      Host OS {{ ansible_distribution }} {{ ansible_distribution_release }}
      is not fully supported.  Please see
      https://docs.ceph.com/docs/master/releases/octopus/
      for more information.
  failed_when: >-
    ansible_distribution not in targets.keys()
    or ansible_distribution_release not in releases
  vars:
    targets:
      CentOS: ["8"]
      Debian: ["buster"]
      Ubuntu: ["bionic"]
    releases: "{{ targets[ansible_distribution] }}"

- name: Set defined variables as facts
  include: facts.yml

- name: Check types of defined variables for issues
  include: types.yml

- name: Check values of defined variables for issues
  include: values.yml
