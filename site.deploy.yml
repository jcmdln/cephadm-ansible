---
# site.deploy.yml

- name: Deploy cephadm-ansible
  any_errors_fatal: true
  gather_facts: false
  tags: always

  hosts:
    - all

  pre_tasks:
    - name: check if some version of Python is installed
      raw: |-
        command -v python || command -v python2 || command -v python3
      register: python_installed
      changed_when: false

    - name: Gather facts
      setup:

  tasks:
    - name: check if host OS is supported
      fail:
        msg: "Reported host OS {{ target }} not supported"
      changed_when: false
      failed_when: target not in targets
      vars:
        target: "{{ ansible_distribution }}-{{ ansible_distribution_version }}"
        targets:
          - Ubuntu-18.04

  roles:
    - role: cephadm-facts
      tags: [always]

    - role: cephadm-check
      tags: [check]

    - role: cephadm-bootstrap
      tags: [bootstrap]

    # - role: cephadm-mon
    #   tags: [mon]

    # - role: cephadm-osd
    #   tags: [osd]
